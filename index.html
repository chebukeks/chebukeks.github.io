<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ультимативный "Любимая игра meme"</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            text-align: center;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(10, minmax(100px, 1fr));
            gap: 0px;
            margin-bottom: 0px;
        }

        .card {
            border: 1px solid #ccc;
            padding: 3px;
            text-align: center;
            background: #fff;
        }

        .image-placeholder {
            min-height: 100px;
            aspect-ratio: 264 / 352;
            background-color: #ddd;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        .card p {
            margin: 0;
        }

        button {
            display: inline-block;
            margin: 10px 5px;
            padding: 10px 20px;
            font-size: 16px;
        }

        .button-container {
            text-align: center;
        }
    </style>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>

<body>
    <div id="capture">
        <h1>УЛЬТИМАТИВНЫЙ "ЛЮБИМАЯ ИГРА MEME"</h1>
        <div class="grid"></div>
    </div>
    <div class="button-container">
        <button id="screenshot">Генерировать скриншот</button>
        <button id="clear">Очистить</button>
    </div>

    <script>
        const phrases = [
            "Игра, которую должен пройти каждый", "Лучшая история", "Любимый визуальный стиль", "Заставляет задуматься", "\"Я тебя закончу, когда-нибудь..\"", "Любимая серия игр", "Лучшая боёвка", "Хорошая игра с плохим комьюнити", "Фанатская игра для фанатов от фанатов", "Игра с наибольшим наигранным временем",
            "200iq стратегия", "Ты любишь, но все ненавидят", "Ты ненавидишь, но всем нравится", "Недооценено", "Переоценено", "Годная инди", "Годная ААА", "Мясо, матюки, убийства...", "Лучшая детская игра", "Когда сиквел лучше оригинала",
            "Годнота отечественных разрабов", "ОМГ эта атмосфера", "Любимый антагонист", "Любимый протагонист", "Любимый второстепенный персонаж", "Релакс после работы/учёбы", "Наибольшее разочарование", "Ремейк/ремастер, который смог", "Вот раньше были игры...", "Друг познаётся в коопе",
            "Ночной кошмар казуальщика", "Игра не для всех", "Любимый симулятор", "Депрессивная игра", "Лучший саундтрек", "\"Почему мне это нравится?\"", "Всегда возвращаешься", "Любимая бесплатная игра", "Нелюбимая игра от любимого разрабочика", "Любимая игра от нелюбимого издателя",
            "Лучший шутер", "Лучший юмор", "Лучший мультиплеер", "Лучший хоррор", "Лучший рогалик", "Лучший выживач/песочница", "Самая первая игра, в которую ты играл", "Самая ожидаемая игра", "Любимая игра для мобилки", "Лучшая концовка"
        ];

        let currentPlaceholder = null;
        let db;

        function initDB(callback) {
            const request = indexedDB.open('imageMemeDB', 1);

            request.onerror = (event) => {
                console.error("Database error: " + event.target.errorCode);
            };

            request.onsuccess = (event) => {
                db = event.target.result;
                callback();
            };

            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                db.createObjectStore('images', { keyPath: 'id' });
            };
        }

        const saveImage = (index, imageBlob) => {
            if (!db) return;
            const transaction = db.transaction(['images'], 'readwrite');
            const objectStore = transaction.objectStore('images');
            const request = objectStore.put({ id: index, image: imageBlob });
            request.onerror = (event) => {
                console.error('Error saving image:', event.target.error);
            };
        };

        const loadImages = () => {
            if (!db) return;
            const transaction = db.transaction(['images'], 'readonly');
            const objectStore = transaction.objectStore('images');
            const placeholders = document.querySelectorAll('.image-placeholder');

            objectStore.getAll().onsuccess = (event) => {
                const images = event.target.result;
                images.forEach(item => {
                    if (placeholders[item.id]) {
                        const imageUrl = URL.createObjectURL(item.image);
                        placeholders[item.id].style.backgroundImage = `url(${imageUrl})`;
                        placeholders[item.id].innerText = '';
                    }
                });
            };
        };

        document.addEventListener('paste', (event) => {
            if (!currentPlaceholder) return;

            const targetPlaceholder = currentPlaceholder;
            const items = event.clipboardData.items;
            let imageFound = false;
            for (let item of items) {
                if (item.type.startsWith('image/')) {
                    const blob = item.getAsFile();
                    const placeholderIndex = parseInt(targetPlaceholder.dataset.index);

                    saveImage(placeholderIndex, blob);

                    const objectURL = URL.createObjectURL(blob);
                    targetPlaceholder.style.backgroundImage = `url(${objectURL})`;
                    targetPlaceholder.innerText = '';

                    imageFound = true;
                    break;
                }
            }
            if (!imageFound) {
                alert('В буфере обмена нет изображения. Убедитесь, что вы скопировали изображение.');
            }
            currentPlaceholder = null;
        });

        const grid = document.querySelector('.grid');
        phrases.forEach((phrase, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            const placeholder = document.createElement('div');
            placeholder.className = 'image-placeholder';
            placeholder.innerText = 'Нажми, чтобы вставить изображение';
            placeholder.dataset.index = index;
            placeholder.addEventListener('click', (event) => {
                currentPlaceholder = event.target;
                alert('Теперь вставьте изображение из буфера обмена (Ctrl+V или Command+V)');
            });
            const text = document.createElement('p');
            text.contentEditable = true;
            text.innerText = phrase;
            card.appendChild(placeholder);
            card.appendChild(text);
            grid.appendChild(card);
        });

        document.getElementById('screenshot').addEventListener('click', () => {
            html2canvas(document.getElementById('capture')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'pobombar_meme.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        });

        document.getElementById('clear').addEventListener('click', () => {
            if (confirm('Вы уверены, что хотите очистить все изображения?')) {
                if (!db) return;
                const transaction = db.transaction(['images'], 'readwrite');
                const objectStore = transaction.objectStore('images');
                const request = objectStore.clear();
                request.onsuccess = () => {
                    location.reload();
                };
                request.onerror = (event) => {
                    console.error('Failed to clear database:', event.target.error);
                }
            }
        });

        window.addEventListener('load', () => {
            initDB(loadImages);
        });
    </script>
</body>

</html>